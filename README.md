# Численное моделирование газодинамики

---

## Постановка задачи

$$
\frac{\partial q}{\partial t} + \frac{\partial f}{\partial x} = g(x, t)
$$

плюс начальные и граничные условия. Здесь

$$
q = \begin{pmatrix} \rho\\ \rho u\\ \rho E \end{pmatrix}
$$

$$
f = \begin{pmatrix} \rho u\\ \rho u^2 + p\\ (\rho E + p)u \end{pmatrix}
$$

$$
E = e + \frac{u^2}{2} = \frac{p}{(\gamma - 1)\rho} + \frac{u^2}{2}
$$

Численная аппроксимация параметров $q$ на временном слое {k+1}

$$
q_j^{k+1} = q_j^k - \frac{\Delta t}{\Delta x}(f_{j+1/2} - f_{j-1/2})
$$

Разделим изучаемую область на $N_x$ подобластей. Для каждой подобласти введем параметры $p_j, \rho_j, u_j, E_j$

---

## Определение потоков

Для поиска потоков через стороны, соединяющие соседние области, будем решать задачу произвольного разрыва, что повзолит нам найти соотношение параметров по разные стороны разрыва. Есть несколько способов численного решения данной задачи:

### Итерационный метод

В большинстве случаев произвольный разрыв распадается на 3 разрыва: **ударную волну**, **контактную поверность** и **волны разряжения**. Используя законы сохрания массы, импульса и энергии, а так же прочие соотношения (Ренкина Гюгонио для ударной волны и т.д.) можно получить соотношение параметров по обе стороны разрыва. Поскольку нам заранее не известны характеристики уравнения, необходимо итерационным методом получаем решение произвольной точности. Найденные ранее соотношения можно использовать в качестве начальных приближений, например, при помощи линеаризации. Однако эти же приближения можно использовать и в качестве финальной аппроксимации, полностью пропуская этапы итерирования

### Линеаризованный распад

Менее точное, приблеженное решение, получается в результате линеаризации соотношений.

$$
p_{j+1/2} = \frac{a_{j+1}\rho_{j+1}p_j + a_j\rho_jp_{j+1} + a_{j+1}\rho_{j+1}a_j\rho_j(u_j-u_{j+1})}{a_{j+1}\rho_{j+1}+a_j\rho_j}
$$

$$
u_{j+1/2}=\frac{a_j\rho_ju_j + a_{j+1}\rho_{j+1}u_{j+1}+p_j-p_{j+1}}{a_{j+1}\rho_{j+1}+a_j\rho_j}
$$

Здесь $a_j=\sqrt{\gamma \frac{p_j}{\rho_j}}$ - скорость звука

Зная $p_{j+1/2}$ необходимо получить $\rho_{j+1/2}$. Если $p_{j+1/2} < p_j$ то справа волны разряжения, поэтому используем соотношение

$$
\rho_{j+1/2}=\rho_j \left( \frac{p_{j+1/2}}{p_j} \right)^{\frac{1}{\gamma}}
$$

Если же $p_{j+1/2} > p_j$, то используем соотношения Ренкина Гюгонио

$$
\rho_{j+1/2} = \rho_j \frac{(\gamma + 1)p_{j+1/2} + (\gamma - 1)p_j}{(\gamma - 1) p_{j+1/2} + (\gamma + 1) p_j}
$$

### Метод HLL

Метод заключается в построении "самых" крайних характеристик $S_+$ и $S_-$:

$$
S_+ = max(u_{j+1} + a_{j+1}, u_j + a_j)
$$

$$
S_- = min(u_{j+1} - a_{j+1}, u_j - a_j)
$$
где $a_j$ - это скорость звука в области $j$.

Далее поток $f_{j+1/2}$ определяется следующим образом:


$$
f_{j+1/2} = \begin{cases} f_j, & \text{если } S_- > 0\\
f_{j+1/2}^{HLL}, & \text{если } S_- < 0 < S_+\\
f_{j+1}, & \text{если } S_+ < 0\end{cases}
$$

$f_{j+1/2}^{HLL}$ определяется так:

$$
f_{j+1/2}^{HLL} = \frac{S_+ f_j - S_- f_{j+1} + S_+ S_- (q_{j+1} - q_j)}{S_+ - S_-}
$$

---

## Граничные условия

Для введения граничных условий вводят виртуальные ячейки. В них подбирают параметры так, чтобы на границе между виртуальной и обычной ячейкой выполнялись определенные условия

### Стенка

$$
\begin{cases} p_0 = p_1\\ \rho_0 = \rho_1\\ u_0 = -u_1 \end{cases}
$$

Для правой границы аналогично. Такие условия гарантируют, что через границу не будет потоков

### Открытая граница

$$
\begin{cases} p_0 = p_1\\ \rho_0 = \rho_1\\ u_0 = u_1 \end{cases}
$$

Для правой границы аналогично.

---

## Устойчивость

Для устойчисвости характеристики на разрывах не должны заходи за границы своих областейДля. Поэтому необходимо соблюдение некоторого соотношения между $\Delta x$ и $\Delta t$.

### Определение $\Delta t$

$$
\Delta t_j = \frac{\Delta x_j}{max(|u_j + a_j|, |u_j - a_j|)}
$$

По всем ячейкам. Далее

$$
\Delta t = k \min_j(\Delta t_j)
$$

где $k \in (0, 1)$ - коэффициент, который необходимо задать

---

## Осесимметричный случай

Переходим к многомерной задаче:

$$
\frac{\partial q}{\partial t} + div(U) + grad(p)^T=0
$$

где

$$
U = \begin{pmatrix} \rho u u & \rho u v & \rho u w\\
\rho v u & \rho v v & \rho v w\\
\rho w u & \rho w v & \rho w w\end{pmatrix}
$$

$$
q = \begin{pmatrix} \rho \\ \rho u \\ \rho v \\ \rho w \\ \rho E \end{pmatrix}
$$

Сводим ее к осесимметричной, цилиндрической задаче

$$
\begin{cases} \frac{\partial \rho}{\partial t} + \frac{1}{r} \frac{\partial r \rho u}{\partial r} = 0\\
\frac{\partial \rho u}{\partial t} + \frac{\partial p}{\partial r} + \frac{1}{r} \frac{\partial r \rho u^2}{\partial r} = 0\\
\frac{\partial \rho E}{\partial t} + \frac{1}{r} \frac{\partial r u (\rho E + p)}{\partial r} = 0\end{cases}
$$

Упростим

$$
\begin{cases} \frac{\partial \rho}{\partial t} + \frac{\partial \rho u}{\partial r} = -\frac{\rho u}{r}\\
\frac{\partial \rho u}{\partial t} + \frac{\partial (p + \rho u^2)}{\partial r} = - \frac{\rho u^2}{r}\\
\frac{\partial \rho E}{\partial t} + \frac{\partial u (\rho E + p)}{\partial r} =-\frac{(\rho E + p) u}{r}\end{cases}
$$

Справа возникает неоднородность $g$. При переходе к схеме конечных объемов заменяем ее на

$$
g_j^k = \begin{pmatrix} -\frac{\rho u}{r}\\ -\frac{\rho u^2}{r}\\ \frac{(\rho E + p) u}{r} \end{pmatrix}
$$

а численная схема изменится на 

$$
q_j^{k+1} = q_j^k - \frac{\Delta t}{\Delta x} (f_{j+1/2} - f_{j-1/2}) + g_j^k \Delta t
$$

### Оптимизация

Для оптимизации будем считать $q_j^{k+1}$ в два этапа. Сначала считаем по формуле выше. Достаем параметры из $q^{k+1}$, по ним считаем новую $g^{k+1}$. Теперь возращаемся обратно на слой $j$ и окончательно получаем:

$$
q_j^{k+1} = q_j^k - \frac{\Delta t}{\Delta x} (f_{j+1/2} - f_{j-1/2}) + \frac{1}{2}(g_j^k + g_j^{k+1}) \Delta t
$$

---

## Второй порядок точности



### Метод Годунова-Колгана

До этого мы считали, что параметры в кажом объеме распределены равномерно. В методе Годунова-Колгана параметры будут распределены кусочно-линейно. Разрыв на границах считается также, только теперь параметры на разных границах одной ячейки отличаются:

$$
q_j(x) = q_j + \frac{\partial q}{\partial x}|_j (x - x_j)
$$

Теперь рассмотрим границу $j+1/2$. Для задачи разрыва надо узнать параметры с 2-х сторон этой границы:

$$
\begin{cases}
q^L_{j+1/2} = q_j + \frac{\partial u}{\partial x}|_j \frac{\Delta x}{2}\\
q^R_{j+1/2} = q_{j+1} - \frac{\partial u}{\partial x}|_{j+1} \frac{\Delta x}{2}
\end{cases}
$$

Производные в объемах считаются так:

$$
\frac{\partial q_j^k}{\partial x} = minmod\left( \frac{u^k_{j+1} - u^k_{j}}{\Delta x}, \frac{u^k_j - u^k_{j-1}}{\Delta x} \right)
$$

где

$$
minmod(a, b) = \frac{1}{2}(sign(a) + sign(b)) \min(|a|, |b|) 
$$


### Метод Родионова

Метод радионова отличается тем, что мы опять считаем $q^{k+1}$ в 2 этапа. На первом этапе считаем как в методе Годунова-Колгана. Далее создаем промежуточный слой $q^{k+1/2} = \frac{1}{2} (q^k + q^{k+1})$. Для него пересчитываем производные и находим потоки $f_{j+1/2}^{k+1/2}$ и $f_{j-1/2}^{k+1/2}$ на границах области решая задачу произвольного разрыва. После этого опять возвращаемся на слой $j$ и получаем окончательное решение:

$$
q^{k+1}_j = q_j^k - \frac{\Delta t}{\Delta x} (f^{k+1/2}_{j+1/2} - f^{k+1/2}_{j-1/2})
$$


Этот метод можно совместить с осесимметричной задачей, получая $g^{k+1/2}$ на том же промежуточном этапе

---

## Энерговклад

Есть 2 способа реализации энерговклада:

### Мгновенный

Если мы хотим в момент времени $t_0$ реализовать мгновенный энерговклад
$$
e \to e + \Delta e
$$

где $e=\frac{p}{(\gamma - 1) \rho}$. Так как при энерговкладе скорость потока и плотность газа не меняются, меняется давлнеие $p$. Тогда

$$
\Delta p = (\gamma - 1) \rho \Delta e
$$

Мгновенный энерговклад реализуется путем добавления $\Delta p$ в начальные условия


### По времени

В таком случае вводится скорость энерговклада $\varepsilon(t)$. Тогда уравнение для энергии примет вид

$$
\frac{\partial \rho E}{\partial t} + \frac{\partial u (\rho E + p)}{\partial r} = -\frac{u(\rho E + p)}{r} + \frac{\partial e}{\partial t}(t)
$$

Для временного энерговклада надо ввести функцию $\varepsilon (t)$, которая будет зависеть от времени, а так же необходимо задать его расположение в пространстве

### В промежутке

Если в задаче необходимо ввести энерговклад в какой то определенный момент времени, то можно использовать любой из вышеперечисленных методов. Для этого сначала включаем симуляцию без энерговклада до нужного момента времени, далее включаем один из 2-х видов энерговклада
